<!DOCTYPE html>  <html> <head>   <title>index.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               index.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <h1>gameclock</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>This proof of concept aims to provide a self-contained application in
one html file. Constraints are:</p>

<ul>
<li><p>One file</p></li>
<li><p>Cacheable by caching browsers, ie under 25K.
(See: http://www.yuiblog.com/blog/2008/02/06/iphone-cacheability/)</p></li>
<li><p>Targeting webkit based native mobile browsers, ie iOS's and Android (2.2, 2.1)</p></li>
<li><p>Other browsers optionally supported only via HTML5 (no custom extensions)</p></li>
<li><p>Must be enjoyable to read and easy to understand.</p></li>
<li><p>Easy to understand</p></li>
<li><p>Interesting techniques will be linked to explanations, for further learning
and great goodness</p></li>
<li><p>Not using libraries to abstract us from the Javascript / DOM. Let's see how far
we can go with what's there already</p></li>
<li><p>Don't be too clever (believe me, I'm restraining myself)</p></li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Directives for JSLint, Javascript checker:</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="c">/*jslint strict: true, maxerr: 1 */</span>
<span class="c">/*global document, window*/</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <h2>self executing anonymous function</h2>

<p>The code is surrounded by a self executing function, that is an anonymous
function which is called just after being created: (function () {...}());</p>

<p>Its purpose is twofold:</p>

<ol>
<li><p>Avoid creating global variables: All variables declared in the scope of
   the function are invisible from outside the function. If you don't
   know why you should avoid global variables, see:
                           http://c2.com/cgi/wiki?GlobalVariablesAreBad</p></li>
<li><p>Create a closure: Even after the anonymous function has executed, its
   values can be referenced afterwards. This allows us to share state
   without creating global objects. See:
                https://developer.mozilla.org/en/JavaScript/Guide/Closures</p></li>
</ol>

<p>This function is passed the document and window objects, which are
external to our code. These are assigned short, one character variable
names for easy access: d = document, w = window</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">d</span><span class="o">,</span> <span class="nx">w</span><span class="p">)</span> <span class="p">{</span> </pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <h2>strict mode</h2>

<p>strict mode prevents us from using questionable "features" in javascript.
           See: http://ejohn.org/blog/ecmascript-5-strict-mode-json-and-more/</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="s2">&quot;use strict&quot;</span><span class="o">;</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <h2>var statement</h2>

<p>All variables are defined under the following var statement. Under strict mode,
variables not declared under "var" will not create a global variable, they
will throw an error instead.</p>

<p>Some functional programming languages don't allow a variable to be assigned
twice. This has some good properties and allows to think about the program
more easily. This style has been adopted, up to where it makes sense. See:
  http://blog.objectmentor.com/articles/2007/02/26/outliving-the-great-variable-shortage</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <h3>constants</h3>

<p>Constants are writen in CAPS. These are not to be changed after being
defined. These iconstants are not language enforced, but convention-enforced.</p>             </td>             <td class="code">               <div class="highlight"><pre> </pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>on touch devices touchstart fires earlier than click
double negation (!!) coerces to boolean</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">CLICK_EVENT</span> <span class="o">=</span> <span class="o">!!</span><span class="nx">d</span><span class="p">.</span><span class="nx">ontouchstart</span> <span class="o">?</span> <span class="s2">&quot;touchstart&quot;</span> <span class="o">:</span> <span class="s2">&quot;click&quot;</span><span class="o">,</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Default state. This object must not be chaged so it's frozen. Frozen objects
throw an exception when they are modified. See
  <a href="https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Object/freeze">here</a></p>

<p>State objects should be JSON serializable, so they can be stored
in localStorage.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">DEFAULT_STATE</span> <span class="o">=</span> <span class="nx">w</span><span class="p">.</span><span class="nb">Object</span><span class="p">.</span><span class="nx">freeze</span><span class="p">({</span> 
      <span class="nx">currentPlayer</span><span class="o">:</span> <span class="s2">&quot;p1&quot;</span><span class="o">,</span>   <span class="c">// player whose time is running</span>
      <span class="nx">name</span><span class="o">:</span> <span class="p">{</span> <span class="nx">p1</span><span class="o">:</span> <span class="s2">&quot;red&quot;</span><span class="o">,</span>     <span class="c">// name of each player</span>
              <span class="nx">p2</span><span class="o">:</span> <span class="s2">&quot;blue&quot;</span> <span class="p">}</span><span class="o">,</span>
      <span class="nx">time</span><span class="o">:</span> <span class="kc">false</span>            <span class="c">// time remaining to each player. Not defined here.</span>
  <span class="p">})</span><span class="o">,</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <h3>undefined declared variables</h3>

<p>Variables declared, but not assigned have value undefined.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">interval</span> <span class="c">/* = undefined */</span><span class="o">,</span> 
  <span class="nx">lastcall</span> <span class="c">/* = undefined */</span><span class="o">,</span>
  <span class="nx">state</span>    <span class="c">/* = undefined */</span><span class="o">,</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Alias for each of the players' buttons</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">p1_button</span> <span class="o">=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">&quot;#p1&quot;</span><span class="p">)</span><span class="o">,</span>
  <span class="nx">p2_button</span> <span class="o">=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">&quot;#p2&quot;</span><span class="p">)</span><span class="o">,</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <h2>Functions.</h2>

<p>Named functions are a bit counter-intuitive so we assign them to variables.
See: http://stackoverflow.com/questions/336859/javascript-var-functionname-function-vs-function-functionname</p>             </td>             <td class="code">               <div class="highlight"><pre> </pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>converts from remaining milliseconds to readable string</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">format_time</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="p">{</span> </pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>t (in ms) is decomposed in hours, minutes and seconds.</p>

<ul>
<li>Math.floor discards the decimal part</li>
<li>% is modulus / remainder operator</li>
<li>seconds not converted to integer, so float</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span>
      <span class="nx">hours</span>   <span class="o">=</span> <span class="nx">w</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">t</span> <span class="o">/</span> <span class="mi">3600000</span><span class="p">)</span><span class="o">,</span>         
      <span class="nx">minutes</span> <span class="o">=</span> <span class="nx">w</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">t</span> <span class="o">%</span> <span class="mi">3600000</span> <span class="o">/</span> <span class="mi">60000</span><span class="p">)</span><span class="o">,</span>
      <span class="nx">seconds</span> <span class="o">=</span>              <span class="nx">t</span> <span class="o">%</span> <span class="mi">60000</span> <span class="o">/</span> <span class="mi">1000</span><span class="o">;</span>     
  </pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>The components are put in an array so that they can be
  .joined afterwards. This avoids reassigning to a variable
  or creating unnecessary intermediate variables.</p>

<ul>
<li>.substr(-n) means "return n last characters"</li>
<li>the minutes part always two digits</li>
<li>the seconds part always 2 digits + 1 decimal</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">return</span> <span class="p">[</span>
      <span class="nx">hours</span><span class="o">,</span>                                 
      <span class="p">(</span><span class="s2">&quot;00&quot;</span> <span class="o">+</span> <span class="nx">minutes</span><span class="p">).</span><span class="nx">substr</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">,</span>           
      <span class="p">(</span><span class="s2">&quot;00&quot;</span> <span class="o">+</span> <span class="nx">seconds</span><span class="p">.</span><span class="nx">toFixed</span><span class="p">(</span><span class="mi">1</span><span class="p">)).</span><span class="nx">substr</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span> </pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>The following skips the hours part if it is 0. It is a bit too clever,
(but so elegant!)</p>

<ul>
<li>if hours is 0 then !hours is "true", which + converts to 1
.slice(1) returns a copy of the array without the first element (hours)</li>
<li>if hours is 1 then !hours is "false", which + converts to 0
.slice(0) returns the whole array, unchanged.</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="p">].</span><span class="nx">slice</span><span class="p">(</span><span class="o">+!</span><span class="nx">hours</span><span class="p">)</span>                         </pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>this creates the time string x:xx:xx.x</p>             </td>             <td class="code">               <div class="highlight"><pre>     <span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">);</span>      
  <span class="p">}</span><span class="o">,</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>displays remaining time on the button of each player</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">display_time</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">p1_button</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">&quot;.time&quot;</span><span class="p">).</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">format_time</span><span class="p">(</span><span class="nx">state</span><span class="p">.</span><span class="nx">time</span><span class="p">.</span><span class="nx">p1</span><span class="p">);</span> 
    <span class="nx">p2_button</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">&quot;.time&quot;</span><span class="p">).</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">format_time</span><span class="p">(</span><span class="nx">state</span><span class="p">.</span><span class="nx">time</span><span class="p">.</span><span class="nx">p2</span><span class="p">);</span> 
  <span class="p">}</span><span class="o">,</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>called about every 100 ms, updates and checks the remaining time </p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">tick</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">now</span>     <span class="o">=</span> <span class="nx">w</span><span class="p">.</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span><span class="o">,</span>
        <span class="nx">elapsed</span> <span class="o">=</span> <span class="nx">now</span> <span class="o">-</span> <span class="nx">lastcall</span><span class="o">;</span> </pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>avoid first call edge-case</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">lastcall</span><span class="p">)</span> <span class="p">{</span>                         </pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>update current player's time.
Expression in () allows for multiline expression</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">state</span><span class="p">.</span><span class="nx">time</span><span class="p">[</span><span class="nx">state</span><span class="p">.</span><span class="nx">currentPlayer</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>   </pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>Avoid setting it to negative values</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">w</span><span class="p">.</span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span>                         
          <span class="mi">0</span><span class="o">,</span>                               
          <span class="nx">state</span><span class="p">.</span><span class="nx">time</span><span class="p">[</span><span class="nx">state</span><span class="p">.</span><span class="nx">currentPlayer</span><span class="p">]</span> <span class="o">-</span> <span class="nx">elapsed</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="nx">lastcall</span> <span class="o">=</span> <span class="nx">now</span><span class="o">;</span>

    <span class="nx">display_time</span><span class="p">();</span>
  
    <span class="k">if</span> <span class="p">(</span><span class="nx">state</span><span class="p">.</span><span class="nx">time</span><span class="p">[</span><span class="nx">state</span><span class="p">.</span><span class="nx">currentPlayer</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>           <span class="c">// currentPlayer lost</span>
      <span class="nx">w</span><span class="p">.</span><span class="nx">clearInterval</span><span class="p">(</span><span class="nx">interval</span><span class="p">);</span>                          <span class="c">// stop calling tick</span>
      <span class="nx">w</span><span class="p">.</span><span class="nx">alert</span><span class="p">(</span><span class="nx">state</span><span class="p">.</span><span class="nx">name</span><span class="p">[</span><span class="nx">state</span><span class="p">.</span><span class="nx">currentPlayer</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; lost&quot;</span><span class="p">);</span> <span class="c">// display end message</span>
      <span class="nx">d</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">&quot;.conf&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="s2">&quot;block&quot;</span><span class="o">;</span>   <span class="c">// then display time selection again</span>
    <span class="p">}</span>
  <span class="p">}</span><span class="o">,</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>Event handlers. These functions are called when a registered event is
triggered. </p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>Called after time selection, sets everything up.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">start_button_handler</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>time  for each player in ms</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="kd">var</span> <span class="nx">time</span> <span class="o">=</span> <span class="nx">w</span><span class="p">.</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">&quot;.conf select&quot;</span><span class="p">).</span><span class="nx">value</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span><span class="o">;</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>stringify then parse trick creates a clone of a serializable object</p>

<p>Cloned object
is sealed, so that no more properties can be added. This alerts us in case
we make a typo in assigning to a property. See:
  <a href="https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Object/seal">here</a></p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">state</span> <span class="o">=</span> <span class="nx">w</span><span class="p">.</span><span class="nb">Object</span><span class="p">.</span><span class="nx">seal</span><span class="p">(</span>

         <span class="nx">w</span><span class="p">.</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">w</span><span class="p">.</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">DEFAULT_STATE</span><span class="p">)));</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>set each player's time</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">state</span><span class="p">.</span><span class="nx">time</span> <span class="o">=</span> <span class="nx">w</span><span class="p">.</span><span class="nb">Object</span><span class="p">.</span><span class="nx">seal</span><span class="p">({</span> <span class="nx">p1</span><span class="o">:</span> <span class="nx">time</span><span class="o">,</span>
                                   <span class="nx">p2</span><span class="o">:</span> <span class="nx">time</span> <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>start calling tick every 100 ms</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">interval</span> <span class="o">=</span> <span class="nx">w</span><span class="p">.</span><span class="nx">setInterval</span><span class="p">(</span><span class="nx">tick</span><span class="o">,</span> <span class="mi">100</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>hide div.conf</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">d</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">&quot;.conf&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span><span class="o">;</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>prevent form submission</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span> 
    <span class="p">}</span><span class="o">,</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>Called when the buttons are tapped / clicked</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">switch_user_handler</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="c">/* event, unused parameter */</span><span class="p">)</span> <span class="p">{</span> </pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>check if the tapped button is the current player's</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">state</span><span class="p">.</span><span class="nx">currentPlayer</span> <span class="o">===</span> <span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>  </pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>if so switch players</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">state</span><span class="p">.</span><span class="nx">currentPlayer</span> <span class="o">===</span> <span class="s2">&quot;p1&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">state</span><span class="p">.</span><span class="nx">currentPlayer</span> <span class="o">=</span> <span class="s2">&quot;p2&quot;</span><span class="o">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">state</span><span class="p">.</span><span class="nx">currentPlayer</span> <span class="o">=</span> <span class="s2">&quot;p1&quot;</span><span class="o">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>end var statement</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="o">;</span></pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>register event handler for the start button</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">d</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">&quot;.conf form&quot;</span><span class="p">)</span>
 <span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;submit&quot;</span><span class="o">,</span> <span class="nx">start_button_handler</span><span class="o">,</span> <span class="kc">false</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>register event handler for the player's buttons</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">p1_button</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="nx">CLICK_EVENT</span><span class="o">,</span> <span class="nx">switch_user_handler</span><span class="o">,</span> <span class="kc">false</span><span class="p">);</span>
<span class="nx">p2_button</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="nx">CLICK_EVENT</span><span class="o">,</span> <span class="nx">switch_user_handler</span><span class="o">,</span> <span class="kc">false</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>Self-executing anonymous function invocation. document and window are
assigned to the d and w parameters.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">}(</span><span class="nb">document</span><span class="o">,</span> <span class="nb">window</span><span class="p">));</span> 

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 